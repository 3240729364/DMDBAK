import rtde_control
import rtde_receive
import time

class UR10eController:
    def __init__(self, host):
        self.rtde_c = rtde_control.RTDEControlInterface(host)
        self.rtde_r = rtde_receive.RTDEReceiveInterface(host)
        self.joint_names = [
            'shoulder_pan_joint', 'shoulder_lift_joint', 
            'elbow_joint', 'wrist_1_joint', 'wrist_2_joint', 'wrist_3_joint'
        ]
    
    def send_qpos(self, qpos, duration=2.0):
        print(f"Moving to joint positions: {qpos}")
        self.rtde_c.moveJ(qpos, 0.5, 0.2)  # 使用默认速度和加速度进行关节运动
        # time.sleep(duration + 1)  # 等待运动完成，添加1秒的缓冲

if __name__ == '__main__':
    try:
        controller = UR10eController('192.168.1.33')  # 请将此处替换为UR10e的实际IP地址
        # qpos_list = [
        #     [-0.16578003, -1.12350498, 2.01220716, -0.99382476, 1.39870349, -0.05686321],
        #     [-0.21698423, -1.02857455, 1.97131841, -1.11702434, 1.34258376, -0.00706072],
        #     [-0.21564195, -0.96562332, 1.90773501, -1.16671497, 1.30034281, 0.0451903],
        #     [-0.17532891, -0.95768468, 1.83295572, -1.16665296, 1.32121525, 0.09789019],
        #     [-0.21317202, -0.9402786, 1.79914386, -1.21154888, 1.25526528, 0.11371969],
        #     [-0.20390674, -0.83977319, 1.7508214, -1.32655408, 1.25016291, 0.15846021],
        #     [-0.18594864, -0.8726652, 1.71271464, -1.35735624, 1.24686355, 0.22269237],
        #     [-0.23144587, -0.89254739, 1.66057746, -1.32205247, 1.15670958, 0.25715034],
        #     [-0.22626252, -0.80941902, 1.61786325, -1.41685808, 1.11494679, 0.29366785],
        #     [-0.17124224, -0.83494607, 1.55723288, -1.38158055, 1.1320338, 0.29761674],
        #     [-0.21486072, -0.72739848, 1.47600157, -1.40591251, 1.07459574, 0.27414296],
        #     [-0.2353275, -0.69146596, 1.42727353, -1.48247095, 1.10156235, 0.28779457],
        #     [-0.17912006, -0.62972883, 1.35062111, -1.51662935, 1.16921243, 0.28273388],
        #     [-0.11876091, -0.63110326, 1.2378337, -1.40807109, 1.26826306, 0.26273776],
        #     [-0.15134103, -0.57214599, 1.15115355, -1.3448903, 1.27316316, 0.28780433],
        #     [-0.16524797, -0.51919056, 1.10391894, -1.42527397, 1.30274044, 0.29939684],
        #     [-0.1012509, -0.53687839, 1.07609186, -1.4334464, 1.32425539, 0.30761254],
        #     [-0.10531689, -0.53762295, 1.09070466, -1.44055442, 1.36142697, 0.29479127],
        #     [-0.14501778, -0.55268462, 1.08851449, -1.4204722, 1.30999366, 0.33931657],
        #     [-0.17972136, -0.55924702, 1.06012527, -1.34830626, 1.23736138, 0.36725314],
        #     [-0.21590364, -0.47706693, 0.95815619, -1.34882835, 1.19344824, 0.42295796],
        #     [-0.23705157, -0.49837982, 0.91774038, -1.28544873, 1.10605372, 0.47915869],
        #     [-0.08122375, -1.20475489, 2.04127829, -0.90357343, 1.48368455, -0.03823372]
        # ]
        #
        qpos_list = [
            # [-0.06193569, -1.18769702, 2.04021902, -0.91956049, 1.52242236, 3.10225043],
            # [-0.12226086, -1.20736221, 1.97656854, -0.86493702, 1.442459, 3.05986305],
            # [-0.19378887, -1.11951723, 1.92833777, -0.95399611, 1.32653974, 3.02861194],
            # [-0.22303005, -1.06486775, 1.87037168, -1.06615993, 1.24263712, 3.0066343],
            # [-0.19739588, -0.94965594, 1.79792312, -1.16047535, 1.21537518, 2.98737728],
            # [-0.16430112, -0.83436914, 1.71167052, -1.23644459, 1.21654533, 2.96930377],
            # [-0.15192576, -0.74482084, 1.61517992, -1.27271675, 1.25425034, 2.94700545],
            # [-0.14720733, -0.72350713, 1.51740415, -1.24984615, 1.30555827, 2.93569032],
            # [-0.13206732, -0.66725789, 1.40506625, -1.21062278, 1.35366767, 2.94097326],
            # [-0.13016425, -0.64784811, 1.28632599, -1.13318335, 1.41727017, 2.96264092],
            # [-0.14245322, -0.59971713, 1.16456996, -1.04140154, 1.44258116, 3.00236373],
            # [-0.14679951, -0.54149091, 1.02486055, -0.96218672, 1.44528909, 3.04325385],
            # [-0.14957245, -0.48216346, 0.87488823, -0.8846999, 1.4190822, 3.09944245],
            # [-0.17363632, -0.42956089, 0.75186864, -0.81895515, 1.42501359, 3.13223137],
            # [-0.17032535, -0.34601272, 0.6039509, -0.73509372, 1.43493569, 3.16285104],
            # [-0.16523967, -0.25805062, 0.44924294, -0.62362779, 1.44421807, 3.19124984],
            # [-0.15679256, -0.18401896, 0.29368721, -0.489933, 1.44882824, 3.22145119]
            [-2.93875473, -1.7135776, 0.36212393, -1.79013899, -0.20283792, -1.57079633],
            [-2.87094419, -1.76957443, 0.50778041, -1.87979862, -0.27064846, -1.57079633],
            [-2.82539841, -1.81201682, 0.62030544, -1.94988127, -0.31619424, -1.57079633],
            [-2.79148901, -1.84715587, 0.71548523, -2.00992202, -0.35010364, -1.57079633],
            [-2.76500136, -1.87745286, 0.79952006, -2.06365986, -0.3765913, -1.57079633],
            [-2.7437308, -1.90417485, 0.87560711, -2.11302491, -0.39786186, -1.57079633],
            [-2.72634434, -1.92807199, 0.94564964, -2.15917031, -0.41524832, -1.57079633],
            [-2.71196045, -1.94962839, 1.01088789, -2.20285215, -0.4296322, -1.57079633],
            [-2.69995898, -1.96917507, 1.07218224, -2.24459983, -0.44163367, -1.57079633],
            [-2.68988389, -1.98694744, 1.13015732, -2.28480253, -0.45170876, -1.57079633],
            [-2.68138852, -2.00311763, 1.18528271, -2.32375773, -0.46020414, -1.57079633],
            [-2.67420223, -2.01781365, 1.23792103, -2.36170003, -0.46739043, -1.57079633],
            [-2.66810941, -2.03113168, 1.28835847, -2.39881944, -0.47348324, -1.57079632],
            [-2.66293528, -2.04314399, 1.33682467, -2.43527333, -0.47865737, -1.57079633],
            [-2.65853627, -2.05390441, 1.38350644, -2.47119469, -0.48305639, -1.57079633],
            [-2.65479285, -2.06345215, 1.42855746, -2.50669796, -0.4867998, -1.57079633],
            [-2.65160454, -2.07181463, 1.47210506, -2.54188308, -0.48998811, -1.57079633],
            [-2.64888624, -2.07900937, 1.51425544, -2.57683873, -0.49270641, -1.57079632],
            [-2.64656506, -2.08504555, 1.55509733, -2.61164443, -0.4950276, -1.57079633],
            [-2.64457822, -2.08992519, 1.59470504, -2.6463725, -0.49701443, -1.57079633],
            [-2.64287127, -2.09364397, 1.63314056, -2.68108924, -0.49872138, -1.57079632],
            [-2.64139652, -2.09619204, 1.67045541, -2.71585603, -0.50019614, -1.57079633],
            [-2.64011202, -2.09755448, 1.70669191, -2.75073009, -0.50148064, -1.57079633],
            [-2.63898069, -2.09771188, 1.74188424, -2.78576501, -0.50261196, -1.57079633],
            [-2.63796934, -2.09664069, 1.77605939, -2.82101136, -0.50362332, -1.57079632],
            [-2.6370477, -2.09431361, 1.8092377, -2.85651673, -0.50454495, -1.57079634],
            [-2.63618895, -2.09070011, 1.84143351, -2.89232605, -0.5054037, -1.57079633],
            [-2.63536783, -2.08576662, 1.87265549, -2.92848152, -0.50622483, -1.57079633],
            [-2.63456119, -2.07947707, 1.90290706, -2.96502264, -0.50703146, -1.57079633],
            [-2.63374717, -2.0717933, 1.93218659, -3.00198595, -0.50784549, -1.57079632],
            [-2.63290481, -2.06267564, 1.96048772, -3.03940473, -0.50868784, -1.57079633],
            [-2.63201387, -2.05208339, 1.98779939, -3.07730865, -0.50957879, -1.57079633],
            [-2.63105439, -2.03997563, 2.01410613, -3.11572316, -0.51053826, -1.57079633],
            [-2.63000635, -2.02631186, 2.03938809, -3.15466888, -0.5115863, -1.57079632],
            [-2.62884914, -2.01105315, 2.0636213, -3.1941608, -0.51274351, -1.57079633],
            [-2.62756123, -1.99416285, 2.08677764, -3.23420744, -0.51403142, -1.57079633],
            [-2.62611977, -1.97560793, 2.10882513, -3.27480986, -0.51547288, -1.57079632],
            [-2.62449973, -1.95536023, 2.12972796, -3.31596039, -0.51709292, -1.57079633],
            [-2.62267323, -1.93339771, 2.14944683, -3.35764177, -0.51891942, -1.57079633],
            [-2.62060872, -1.90970597, 2.16793894, -3.39982562, -0.52098393, -1.57079633],
            [-2.61826939, -1.88427973, 2.18515839, -3.44247131, -0.52332326, -1.57079633],
            [-2.61561167, -1.85712405, 2.201056, -3.4855246, -0.52598098, -1.57079632],
            [-2.61258253, -1.82825615, 2.21557991, -3.52891642, -0.52901013, -1.57079632],
            [-2.60911603, -1.7977063, 2.22867496, -3.57256132, -0.53247662, -1.57079633],
            [-2.60512767, -1.76551917, 2.24028265, -3.61635614, -0.53646498, -1.57079632],
            [-2.60050578, -1.73175494, 2.25033992, -3.66017763, -0.54108687, -1.57079633],
            [-2.595097, -1.69649037, 2.2587767, -3.70387896, -0.54649566, -1.57079633],
            [-2.58868064, -1.65982139, 2.26551113, -3.7472824, -0.55291201, -1.57079632],
            [-2.58091852, -1.62186953, 2.27043941, -3.79016254, -0.56067413, -1.57079632],
            [-2.57124564, -1.58280206, 2.27341159, -3.83220217, -0.57034701, -1.57079632],
            [-2.55858869, -1.5429109, 2.27416973, -3.87285149, -0.58300396, -1.57079633],
            [-2.54043159, -1.50302771, 2.2721356, -3.91070055, -0.60116106, -1.57079633],
            [-2.50839232, -1.46901084, 2.26541523, -3.93799704, -0.63320033, -1.57079633]
        ]

        # qpos_list = [
        #     # [-0.06193569, -1.18769702, 2.04021902, -0.91956049, 1.52242236, 3.10225043],
        #     # [-0.12226086, -1.20736221, 1.97656854, -0.86493702, 1.442459, 3.05986305],
        #     # [-0.19378887, -1.11951723, 1.92833777, -0.95399611, 1.32653974, 3.02861194],
        #     # [-0.22303005, -1.06486775, 1.87037168, -1.06615993, 1.24263712, 3.0066343],
        #     # [-0.19739588, -0.94965594, 1.79792312, -1.16047535, 1.21537518, 2.98737728],
        #     # [-0.16430112, -0.83436914, 1.71167052, -1.23644459, 1.21654533, 2.96930377],
        #     # [-0.15192576, -0.74482084, 1.61517992, -1.27271675, 1.25425034, 2.94700545],
        #     # [-0.14720733, -0.72350713, 1.51740415, -1.24984615, 1.30555827, 2.93569032],
        #     # [-0.13206732, -0.66725789, 1.40506625, -1.21062278, 1.35366767, 2.94097326],
        #     # [-0.13016425, -0.64784811, 1.28632599, -1.13318335, 1.41727017, 2.96264092],
        #     # [-0.14245322, -0.59971713, 1.16456996, -1.04140154, 1.44258116, 3.00236373],
        #     # [-0.14679951, -0.54149091, 1.02486055, -0.96218672, 1.44528909, 3.04325385],
        #     # [-0.14957245, -0.48216346, 0.87488823, -0.8846999, 1.4190822, 3.09944245],
        #     # [-0.17363632, -0.42956089, 0.75186864, -0.81895515, 1.42501359, 3.13223137],
        #     # [-0.17032535, -0.34601272, 0.6039509, -0.73509372, 1.43493569, 3.16285104],
        #     # [-0.16523967, -0.25805062, 0.44924294, -0.62362779, 1.44421807, 3.19124984],
        #     # [-0.15679256, -0.18401896, 0.29368721, -0.489933, 1.44882824, 3.22145119]
        #     [-2.68138852, -2.00311763, 1.18528271, -2.32375773, -0.46020414, -1.57079633],
        #
        # ]

        for qpos in qpos_list:
            controller.send_qpos(qpos)
    except Exception as e:
        print(f"An error occurred: {e}")
    finally:
        controller.rtde_c.disconnect()
        controller.rtde_r.disconnect()
        print("Disconnected from UR5e")